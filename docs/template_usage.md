# Template Usage Guide

This guide explains the structure and usage of the Jinja2 templates, static assets, and helper scripts in this project.

## Project Structure

-   `templates/`: Contains all Jinja2 HTML templates.
    -   `base.html`: The main base template that all page templates extend.
    -   `macros/`: Contains Jinja2 macros for reusable UI components.
        -   `cards.html`: Macros for rendering Bootstrap cards.
        -   `common_blocks.html`: Macros for other common UI elements like user badges and video embeds.
    -   `pages/`: Contains example page templates that demonstrate usage of the base template and macros.
        -   `home.html`: Example homepage.
        -   `profile.html`: Example user profile page.
        -   `article.html`: Example article page.
        -   `auth.html`: Example login/registration page.
-   `static/`: Contains static assets like CSS and JavaScript.
    -   `css/`: Stylesheets.
        -   `themes.css`: Defines light and dark theme color variables.
        -   `layouts.css`: Defines styles for different page layouts (standard, wide, focused).
    -   `js/`: JavaScript files.
        -   `prefs.js`: Handles theme and layout switching, and stores preferences in localStorage.
-   `render_examples.py`: A Python script to render the example page templates into static HTML files in the `dist/` directory.
-   `dist/`: (Generated by `render_examples.py`) Contains the static HTML output of the example pages. This directory is ignored by Git (see `.gitignore`).
-   `docs/`: Contains documentation files.
    -   `template_usage.md`: This file.

## Base Template (`templates/base.html`)

`base.html` is the foundational template that provides the common HTML structure for all pages. It includes Bootstrap 5.3 CSS and JS from a CDN, links to custom theme and layout stylesheets, and incorporates the preference management script (`prefs.js`).

Key Jinja2 blocks for extension in child templates:

-   `{% block title %}My Site{% endblock title %}`: Defines the page title, visible in the browser tab/window title bar and used by search engines.
-   `{% block head_extra %}{% endblock head_extra %}`: Allows adding extra elements to the HTML `<head>` section, such as page-specific meta tags, CSS links, or inline styles.
-   `{% block body_attributes %}{% endblock body_attributes %}`: Allows adding attributes (e.g., classes) to the `<body>` tag, useful for page-specific styling.
-   `{% block header %}{% endblock header %}`: Contains the site header, typically including the main navigation bar. The default header includes a "Preferences" button.
-   `{% block main_content %}{% endblock main_content %}`: The primary content area for the page. This is where the unique content of each page goes.
-   `{% block sidebar %}{% endblock sidebar %}`: An optional sidebar area. The base template uses a Bootstrap `col-md-4` for this.
-   `{% block footer %}{% endblock footer %}`: Contains the site footer, usually for copyright information, links, etc.
-   `{% block scripts_extra %}{% endblock scripts_extra %}`: For adding page-specific JavaScript files or inline scripts at the end of the body.

An inline script in `base.html` also handles applying theme and layout preferences from `localStorage` as early as possible to prevent a "Flash of Unstyled Content" (FOUC).

## Themes

Themes (light/dark) are managed by `static/js/prefs.js` and defined in `static/css/themes.css`.

-   **Switching Themes**:
    -   Users can switch themes using the "Preferences" popover, typically located in the header.
    -   Options are "Light", "Dark", and "Auto".
    -   "Auto" mode respects the user's operating system preference (`prefers-color-scheme`).
-   **CSS Definition (`static/css/themes.css`)**:
    -   Themes are primarily defined using CSS custom properties (variables).
    -   Light theme variables are defined under `:root`.
    -   Dark theme variables are defined under the `[data-bs-theme="dark"]` attribute selector.
    -   Bootstrap's own CSS variables are overridden where necessary to ensure the theme applies correctly.
-   **Applying Themes**:
    -   The `prefs.js` script sets the `data-bs-theme` attribute on the `<html>` element (e.g., `<html data-bs-theme="dark">`).
    -   The FOUC prevention script in `base.html` also sets this attribute on initial load based on stored preferences.

## Layouts

Page layouts (standard, wide, focused) are managed by `static/js/prefs.js` and defined in `static/css/layouts.css`.

-   **Switching Layouts**:
    -   Users can switch layouts using the "Preferences" popover.
    -   Options are "Standard", "Wide", and "Focused".
-   **CSS Definition (`static/css/layouts.css`)**:
    -   `standard`: Relies on the default Bootstrap container behavior.
    -   `wide`: Targets `main.container` when `[data-layout="wide"]` is set, making it wider (e.g., `max-width: 95%`).
    -   `focused`: Targets `main.container` when `[data-layout="focused"]` is set, making it narrower for better readability of text-heavy content (e.g., `max-width: 760px`).
        -   **Note**: The `focused` layout currently has placeholder styles. More specific styling (e.g., font adjustments, clutter reduction) is a TODO item.
-   **Applying Layouts**:
    -   The `prefs.js` script sets the `data-layout` attribute on the `<html>` element (e.g., `<html data-layout="wide">`).
    -   The FOUC prevention script in `base.html` also sets this attribute on initial load.

## Macros

Macros are reusable snippets of HTML, defined in files within `templates/macros/`. They help maintain consistency and reduce code duplication.

-   **Importing Macros**:
    To use a macro in a template, import it first. For example:
    ```jinja
    {% import "macros/cards.html" as card_macros %}
    {{ card_macros.render_card(title="My Card", content="...") }}
    ```
    Or, import specific macros:
    ```jinja
    {% from "macros/cards.html" import render_card %}
    {{ render_card(title="My Card", content="...") }}
    ```

### `render_card` (from `macros/cards.html`)

Renders a Bootstrap card component.

-   **Parameters**:
    -   `title` (str): The title of the card.
    -   `content` (str): HTML content for the card body.
    -   `image_url` (str, optional): URL for an image to display at the top of the card.
    -   `link_url` (str, optional): URL the card can link to. If provided, the card title becomes a link, and a "Read More" button is displayed.
    -   `extra_classes` (str, optional): Extra CSS classes to add to the card's main `div` element.
-   **Example Usage**:
    ```jinja
    {{ card_macros.render_card(
        title="Amazing Article",
        content="This is a summary of the article.",
        image_url="path/to/image.jpg",
        link_url="/articles/amazing-article",
        extra_classes="shadow-sm mb-3"
    ) }}
    ```

### `render_user_profile_badge` (from `macros/common_blocks.html`)

Renders a user profile badge, typically showing an avatar and name.

-   **Parameters**:
    -   `user_name` (str): The name of the user.
    -   `avatar_url` (str, optional): URL for the user's avatar image. If not provided, a placeholder with the user's initial is shown.
    -   `profile_url` (str, optional): URL to the user's profile page. If provided, the badge (name) becomes a link.
    -   `size` (str, optional): Size of the badge: 'small', 'normal', or 'large'. Default is 'normal'. This primarily affects the avatar image size.
-   **Example Usage**:
    ```jinja
    {{ common_macros.render_user_profile_badge(
        user_name="Jane Doe",
        avatar_url="path/to/avatar.png",
        profile_url="/users/jane-doe",
        size="small"
    ) }}
    ```

### `render_video_embed` (from `macros/common_blocks.html`)

Renders an embedded video player.

-   **Parameters**:
    -   `video_url` (str): The URL of the video.
    -   `platform` (str, optional): The video platform. Currently supports 'youtube'. 'videojs' is a placeholder. Defaults to 'youtube'.
    -   `responsive` (bool, optional): Whether to make the embed responsive using Bootstrap's aspect ratio classes. Defaults to `True`.
    -   `aspect_ratio` (str, optional): The aspect ratio for responsive embeds (e.g., '16x9', '4x3'). Defaults to '16x9'.
-   **Example Usage (YouTube)**:
    ```jinja
    {{ common_macros.render_video_embed(
        video_url="https://www.youtube.com/watch?v=dQw4w9WgXcQ",
        platform="youtube",
        responsive=True,
        aspect_ratio="16x9"
    ) }}
    ```
-   **VideoJS Support**:
    -   Basic placeholder structure for VideoJS is included.
    -   **TODO**: Full VideoJS integration requires proper player setup, including dynamic loading of VideoJS CSS/JS assets if not globally available. The current `data-setup` for VideoJS is also a basic example.

## Example Pages (`templates/pages/`)

The `templates/pages/` directory contains example pages demonstrating how to extend `base.html` and use the provided macros.

-   `home.html`: A sample homepage.
-   `profile.html`: A sample user profile page.
-   `article.html`: A sample article page.
-   `auth.html`: Sample login and registration forms (frontend only).

### Rendering Example Pages

The `render_examples.py` script can be used to generate static HTML previews of these pages.

-   **Purpose**: To compile the Jinja2 templates into viewable HTML files without needing a full web framework.
-   **How to Run**:
    1.  Navigate to the root directory of the project in your terminal.
    2.  Run the script: `python render_examples.py`
        (Or, if you've made it executable: `./render_examples.py`)
    3.  The script will generate HTML files in the `dist/` directory.
-   **Viewing**:
    -   You can open the HTML files directly in your browser (e.g., `file:///path/to/project/dist/home.html`).
    -   For a better experience (especially with relative asset paths), serve the `dist` directory using a local web server. The script provides instructions for using Python's built-in server:
        ```bash
        cd /path/to/project
        python -m http.server --directory dist
        ```
        Then open `http://localhost:8000` in your browser.
-   The script includes a `mock_url_for` function to handle static asset paths correctly for the `dist/` structure.

## Key TODO Items for Future Development

This list summarizes important improvements and features planned or needed:

-   **Focused Layout Styling**: (`static/css/layouts.css`)
    -   Develop specific styles for the 'focused' layout beyond just width adjustment (e.g., typography, spacing, reduced clutter).
    -   Decide if header/footer should also be narrowed in 'focused' mode.
-   **VideoJS Integration**: (`templates/macros/common_blocks.html`)
    -   Implement full VideoJS player setup in the `render_video_embed` macro.
    -   Ensure VideoJS CSS and JS assets are correctly linked or dynamically loaded when the macro is used.
    -   Handle different `video_url` types for VideoJS (e.g., direct MP4 links vs. YouTube links via VideoJS YouTube tech).
-   **Macro Enhancements**:
    -   `render_card` (`macros/cards.html`): Make the "Read More" button optional or configurable.
    -   `render_user_profile_badge` (`macros/common_blocks.html`): Add specific CSS classes for different sizes if more styling control is needed beyond avatar dimensions.
-   **Preference Popover**: (`static/js/prefs.js`)
    -   Add more preference options (e.g., font size, animation controls).
-   **Authentication Forms**: (`templates/pages/auth.html`)
    -   These are currently front-end only. Backend logic is required for actual user authentication.
-   **Dynamic Article Table of Contents**: (`templates/pages/article.html`)
    -   The sidebar ToC is currently static. It could be dynamically generated if article headings have IDs.
-   **Error Handling in `render_examples.py`**:
    -   More robust error handling for missing templates or incorrect context data.
-   **Accessibility (A11y)**:
    -   Continuously review and improve accessibility across all components and pages (e.g., ARIA attributes, keyboard navigation, color contrast).

This documentation should provide a good overview of the template system.
